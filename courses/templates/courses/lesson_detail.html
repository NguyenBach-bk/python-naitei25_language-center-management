{% extends 'base.html' %}
{% load i18n static %}

{% block content %}
<div class="container mt-4"
     data-lesson-id="{{ lesson.pk }}"
     data-complete-url="{% url 'user_progress:mark_lesson_complete' lesson.pk %}">
  <h2 class="mb-3">{{ lesson.title }}</h2>

  <p class="lead">{{ lesson.description }}</p>

  <p>
    <strong>{% trans "Status:" %}</strong>
    <span id="lesson-status"
          class="badge {% if lesson.pk in completed_lessons %}badge-success{% else %}badge-secondary{% endif %}">
      {% if lesson.pk in completed_lessons %}
        {% trans "Completed" %}
      {% else %}
        {% trans "Not Started" %}
      {% endif %}
    </span>
  </p>

  <div class="lesson-video mb-4">
    {% if embed_url %}
      <div class="embed-responsive embed-responsive-16by9">
        <iframe class="embed-responsive-item"
                src="{{ embed_url }}"
                allowfullscreen
                title="{% blocktrans with t=lesson.title %}Video bài học: {{ t }}{% endblocktrans %}">
        </iframe>
      </div>
    {% elif lesson.video_file %}
      <video controls preload="metadata" class="w-100">
        <source src="{{ lesson.video_file.url }}" type="video/mp4">
        {% trans "Trình duyệt của bạn không hỗ trợ phát video." %}
      </video>
    {% else %}
      <p class="text-muted">{% trans "Chưa có video cho bài học này." %}</p>
    {% endif %}
  </div>

  {% if lesson.quiz %}
    <a href="{% url 'quizzes:quiz_detail' lesson_id=lesson.pk %}"
       class="btn btn-success mb-3">
      {% trans "Take Quiz" %}
    </a>
  {% endif %}

  <a href="{% url 'courses:lesson_list' course_id=lesson.course.id %}"
     class="btn btn-outline-secondary">
    &larr; {% trans "Quay lại danh sách bài học" %}
  </a>
</div>

<script src="{% static 'js/lesson_detail.js' %}"></script>
{% endblock content %}
